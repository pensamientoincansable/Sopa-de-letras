<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sopa de Letras - 50 Niveles</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800&family=Quicksand:wght@700&family=Nunito:wght@800&family=Comfortaa:wght@700&family=Fredoka:wght@600;700&family=Baloo+2:wght@700&family=Patrick+Hand&family=Caveat:wght@700&family=Pacifico&family=Righteous&family=Lobster&family=Satisfy&family=Dancing+Script:wght@700&family=Indie+Flower&family=Shadows+Into+Light&family=Amatic+SC:wght@700&family=Bangers&family=Permanent+Marker&family=Orbitron:wght@700&family=Press+Start+2P&family=Russo+One&family=Bungee&family=Alfa+Slab+One&family=Luckiest+Guy&family=Passion+One:wght@700&family=Titan+One&family=Lilita+One&family=Chewy&family=Fugaz+One&family=Lemon&family=Sigmar+One&family=Rubik+Mono+One&family=Black+Ops+One&family=Boogaloo&family=Creepster&family=Fascinate&family=Freckle+Face&family=Gorditas:wght@700&family=Holtwood+One+SC&family=Knewave&family=Modak&family=Monoton&family=Nabla&family=Neucha&family=Oleo+Script:wght@700&family=Rampart+One&family=Ribeye&family=Rye&family=Shrikhand&family=Sunshiney&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Poppins', sans-serif;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
        }

        .game-bg {
            position: fixed;
            inset: 0;
            background-size: cover;
            background-position: center;
            z-index: -1;
            transition: background-image 0.5s ease;
        }

        .game-bg::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }

        .screen {
            display: none;
            position: fixed;
            inset: 0;
            flex-direction: column;
        }

        .screen.active {
            display: flex;
        }

        .grid-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            text-transform: uppercase;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.15s, background 0.15s;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.9), 0 0 15px rgba(255,255,255,0.4);
            background: rgba(255, 255, 255, 0.08);
            color: #ffffff;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .grid-cell.selected {
            transform: scale(1.12);
            z-index: 10;
        }

        #selectionCanvas {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 5;
        }

        .word-item {
            padding: 6px 14px;
            margin: 4px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 700;
            transition: all 0.3s;
            background: rgba(255,255,255,0.1);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
        }

        .word-item.found {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.6), rgba(59, 130, 246, 0.6));
            text-decoration: line-through;
            text-decoration-color: #fbbf24;
            text-decoration-thickness: 3px;
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .celebrate {
            animation: celebrate 0.4s ease;
        }

        .level-btn {
            aspect-ratio: 1;
            border-radius: 12px;
            font-weight: 800;
            transition: transform 0.2s, box-shadow 0.2s;
            border: none;
            cursor: pointer;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .level-btn:not(.locked):hover {
            transform: scale(1.08);
        }

        .level-btn.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-box {
            background: rgba(20, 20, 40, 0.95);
            border-radius: 24px;
            padding: 30px;
            max-width: 380px;
            width: 100%;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 200;
        }

        ::-webkit-scrollbar { width: 0; }

        /* Animaci√≥n del t√≠tulo */
        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(168, 85, 247, 0.8), 0 0 40px rgba(236, 72, 153, 0.6); }
            50% { text-shadow: 0 0 30px rgba(236, 72, 153, 0.8), 0 0 60px rgba(168, 85, 247, 0.6); }
        }

        .title-glow {
            animation: titleGlow 3s ease-in-out infinite;
        }

        /* Animaci√≥n de los botones del men√∫ */
        @keyframes menuBtnPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
            50% { box-shadow: 0 0 35px rgba(168, 85, 247, 0.7); }
        }

        .menu-btn {
            animation: menuBtnPulse 2s ease-in-out infinite;
        }

        /* Font cards */
        .font-card {
            transition: all 0.3s ease;
        }

        .font-card:hover {
            transform: translateY(-5px);
        }

        .font-card.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }

        /* 50 FUENTES √öNICAS */
        .font-1 { font-family: 'Poppins', sans-serif; }
        .font-2 { font-family: 'Quicksand', sans-serif; }
        .font-3 { font-family: 'Nunito', sans-serif; }
        .font-4 { font-family: 'Comfortaa', cursive; }
        .font-5 { font-family: 'Fredoka', sans-serif; }
        .font-6 { font-family: 'Baloo 2', cursive; }
        .font-7 { font-family: 'Patrick Hand', cursive; }
        .font-8 { font-family: 'Caveat', cursive; }
        .font-9 { font-family: 'Pacifico', cursive; }
        .font-10 { font-family: 'Righteous', cursive; }
        .font-11 { font-family: 'Lobster', cursive; }
        .font-12 { font-family: 'Satisfy', cursive; }
        .font-13 { font-family: 'Dancing Script', cursive; }
        .font-14 { font-family: 'Indie Flower', cursive; }
        .font-15 { font-family: 'Shadows Into Light', cursive; }
        .font-16 { font-family: 'Amatic SC', cursive; }
        .font-17 { font-family: 'Bangers', cursive; }
        .font-18 { font-family: 'Permanent Marker', cursive; }
        .font-19 { font-family: 'Orbitron', sans-serif; }
        .font-20 { font-family: 'Press Start 2P', cursive; }
        .font-21 { font-family: 'Russo One', sans-serif; }
        .font-22 { font-family: 'Bungee', cursive; }
        .font-23 { font-family: 'Alfa Slab One', cursive; }
        .font-24 { font-family: 'Luckiest Guy', cursive; }
        .font-25 { font-family: 'Passion One', cursive; }
        .font-26 { font-family: 'Titan One', cursive; }
        .font-27 { font-family: 'Lilita One', cursive; }
        .font-28 { font-family: 'Chewy', cursive; }
        .font-29 { font-family: 'Fugaz One', cursive; }
        .font-30 { font-family: 'Lemon', cursive; }
        .font-31 { font-family: 'Sigmar One', cursive; }
        .font-32 { font-family: 'Rubik Mono One', monospace; }
        .font-33 { font-family: 'Black Ops One', cursive; }
        .font-34 { font-family: 'Boogaloo', cursive; }
        .font-35 { font-family: 'Creepster', cursive; }
        .font-36 { font-family: 'Fascinate', cursive; }
        .font-37 { font-family: 'Freckle Face', cursive; }
        .font-38 { font-family: 'Gorditas', cursive; }
        .font-39 { font-family: 'Holtwood One SC', serif; }
        .font-40 { font-family: 'Knewave', cursive; }
        .font-41 { font-family: 'Modak', cursive; }
        .font-42 { font-family: 'Monoton', cursive; }
        .font-43 { font-family: 'Nabla', cursive; }
        .font-44 { font-family: 'Neucha', cursive; }
        .font-45 { font-family: 'Oleo Script', cursive; }
        .font-46 { font-family: 'Rampart One', cursive; }
        .font-47 { font-family: 'Ribeye', cursive; }
        .font-48 { font-family: 'Rye', cursive; }
        .font-49 { font-family: 'Shrikhand', cursive; }
        .font-50 { font-family: 'Sunshiney', cursive; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen overflow-hidden">
    <div id="gameBg" class="game-bg"></div>

    <!-- ========== MEN√ö PRINCIPAL ========== -->
    <div id="menuScreen" class="screen active">
        <div class="flex-1 flex flex-col items-center justify-center p-6">
            <!-- Logo/T√≠tulo -->
            <div class="text-center mb-12">
                <div class="text-6xl mb-4">üî§</div>
                <h1 class="text-4xl md:text-5xl font-extrabold bg-gradient-to-r from-purple-400 via-pink-400 to-yellow-400 bg-clip-text text-transparent title-glow mb-2">
                    Sopa de Letras
                </h1>
                <p class="text-white/60 text-lg">50 Niveles ¬∑ 50 Fuentes √önicas</p>
            </div>

            <!-- Botones del men√∫ -->
            <div class="flex flex-col gap-4 w-full max-w-xs">
                <button id="playBtn" class="menu-btn w-full py-4 px-8 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 rounded-2xl font-bold text-xl transition-all flex items-center justify-center gap-3">
                    <span class="text-2xl">‚ñ∂</span> JUGAR
                </button>
                
                <button id="fontsBtn" class="w-full py-4 px-8 bg-gradient-to-r from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 rounded-2xl font-bold text-xl transition-all flex items-center justify-center gap-3 shadow-lg">
                    <span class="text-2xl">üî†</span> MIS FUENTES
                </button>
                
                <button id="exitBtn" class="w-full py-4 px-8 bg-white/10 hover:bg-white/20 rounded-2xl font-bold text-xl transition-all flex items-center justify-center gap-3 border border-white/20">
                    <span class="text-2xl">üö™</span> SALIR
                </button>
            </div>

            <!-- Estad√≠sticas -->
            <div class="mt-10 glass rounded-2xl px-6 py-4 text-center">
                <p class="text-white/60 text-sm">Progreso</p>
                <p class="text-2xl font-bold"><span id="menuMaxLevel">1</span>/50 Niveles</p>
                <p class="text-white/50 text-xs mt-1"><span id="menuFontsUnlocked">0</span> fuentes desbloqueadas</p>
            </div>
        </div>

        <!-- M√∫sica toggle -->
        <div class="absolute top-4 right-4">
            <button id="musicBtnMenu" class="w-12 h-12 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-2xl transition-all">üîá</button>
        </div>
    </div>

    <!-- ========== PANTALLA DE NIVELES ========== -->
    <div id="levelScreen" class="screen">
        <header class="glass-dark p-3 flex items-center justify-between">
            <button id="backToMenuBtn" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
            </button>
            <div class="text-center">
                <p class="font-bold text-lg">Selecciona Nivel</p>
                <p class="text-xs text-white/60">Nivel m√°ximo: <span id="maxLevelText">1</span></p>
            </div>
            <button id="musicBtn" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-xl">üîá</button>
        </header>

        <main class="flex-1 overflow-y-auto p-2">
            <div id="levelsGrid" class="grid grid-cols-5 gap-2 w-full max-w-md mx-auto"></div>
        </main>
    </div>

    <!-- ========== PANTALLA DE FUENTES ========== -->
    <div id="fontsScreen" class="screen">
        <header class="glass-dark p-3 flex items-center justify-between">
            <button id="backToMenuFromFonts" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
            </button>
            <div class="text-center">
                <p class="font-bold text-lg">üî† Mis Fuentes</p>
                <p class="text-xs text-white/60"><span id="fontsUnlockedCount">0</span>/50 desbloqueadas</p>
            </div>
            <div class="w-10"></div>
        </header>

        <main class="flex-1 overflow-y-auto p-3">
            <p class="text-center text-white/60 text-sm mb-4">¬°Completa niveles para desbloquear fuentes √∫nicas!</p>
            <div id="fontsGrid" class="grid grid-cols-2 gap-3 max-w-lg mx-auto"></div>
        </main>
    </div>

    <!-- ========== PANTALLA DE JUEGO ========== -->
    <div id="gameScreen" class="screen">
        <header class="glass-dark p-2 flex items-center justify-between">
            <button id="backBtn" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
            </button>
            <div class="text-center">
                <p id="levelTitle" class="font-bold">Nivel 1</p>
                <p id="levelTheme" class="text-xs text-white/60">Tema</p>
            </div>
            <button id="hintBtn" class="w-10 h-10 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 flex items-center justify-center text-xl">üí°</button>
        </header>

        <div class="glass-dark mx-2 mt-1 p-2 rounded-xl">
            <div id="wordList" class="flex flex-wrap justify-center"></div>
            <p class="text-center text-xs text-white/50 mt-1"><span id="foundCount">0</span>/<span id="totalCount">0</span> palabras</p>
        </div>

        <div class="flex-1 flex items-center justify-center p-1">
            <div id="gridContainer" class="glass rounded-xl p-1 w-[98vw] h-[60vh] max-w-[98vw] max-h-[60vh] relative mx-auto">
                <canvas id="selectionCanvas"></canvas>
                <div id="gameGrid" class="grid gap-[1px] h-full w-full relative z-10"></div>
            </div>
        </div>
    </div>

    <!-- ========== MODAL NIVEL COMPLETADO ========== -->
    <div id="completeModal" class="modal-overlay">
        <div class="modal-box">
            <div class="text-6xl mb-4">üéâ</div>
            <h2 class="text-2xl font-bold mb-2">¬°Nivel Completado!</h2>
            <p class="text-white/60 mb-2">Has encontrado todas las palabras</p>
            
            <!-- Fuente desbloqueada -->
            <div id="fontUnlockSection" class="bg-gradient-to-r from-amber-500/20 to-orange-500/20 rounded-xl p-4 mb-4 border border-amber-500/30">
                <p class="text-amber-400 text-sm mb-2">üîì ¬°Nueva fuente desbloqueada!</p>
                <p id="unlockedFontName" class="text-xl font-bold text-white"></p>
                <p id="unlockedFontPreview" class="text-2xl mt-2 text-amber-300">ABCDEFG</p>
            </div>
            
            <div class="flex gap-3">
                <button id="replayBtn" class="flex-1 py-3 bg-white/10 hover:bg-white/20 rounded-xl font-semibold transition">üîÑ Repetir</button>
                <button id="nextBtn" class="flex-1 py-3 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl font-semibold">Siguiente ‚ñ∂</button>
            </div>
        </div>
    </div>

    <!-- ========== MODAL PISTA ========== -->
    <div id="hintModal" class="modal-overlay">
        <div class="modal-box">
            <div class="text-5xl mb-4">üí°</div>
            <h2 class="text-xl font-bold mb-2">¬øNecesitas una pista?</h2>
            <p class="text-white/60 mb-6">Mira un anuncio para revelar una letra</p>
            <button id="watchAdBtn" class="w-full py-3 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl font-semibold mb-3 flex items-center justify-center gap-2">
                <span>‚ñ∂</span> Ver Anuncio
            </button>
            <button id="cancelHintBtn" class="w-full py-3 bg-white/10 hover:bg-white/20 rounded-xl font-semibold transition">Cancelar</button>
            <div id="adLoading" class="hidden mt-4">
                <div class="w-8 h-8 border-4 border-white/30 border-t-white rounded-full animate-spin mx-auto mb-2"></div>
                <p class="text-xs text-white/50">Cargando anuncio...</p>
            </div>
        </div>
    </div>

    <!-- ========== MODAL SALIR ========== -->
    <div id="exitModal" class="modal-overlay">
        <div class="modal-box">
            <div class="text-5xl mb-4">üëã</div>
            <h2 class="text-xl font-bold mb-2">¬øSalir del juego?</h2>
            <p class="text-white/60 mb-6">Tu progreso est√° guardado</p>
            <div class="flex gap-3">
                <button id="cancelExitBtn" class="flex-1 py-3 bg-white/10 hover:bg-white/20 rounded-xl font-semibold transition">Cancelar</button>
                <button id="confirmExitBtn" class="flex-1 py-3 bg-gradient-to-r from-red-500 to-pink-500 rounded-xl font-semibold">Salir</button>
            </div>
        </div>
    </div>

    <audio id="bgMusic" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-serene-view-443.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ============ DATOS DE FUENTES ============
        const fontData = [
            { name: "Poppins", family: "Poppins" },
            { name: "Quicksand", family: "Quicksand" },
            { name: "Nunito", family: "Nunito" },
            { name: "Comfortaa", family: "Comfortaa" },
            { name: "Fredoka", family: "Fredoka" },
            { name: "Baloo 2", family: "Baloo 2" },
            { name: "Patrick Hand", family: "Patrick Hand" },
            { name: "Caveat", family: "Caveat" },
            { name: "Pacifico", family: "Pacifico" },
            { name: "Righteous", family: "Righteous" },
            { name: "Lobster", family: "Lobster" },
            { name: "Satisfy", family: "Satisfy" },
            { name: "Dancing Script", family: "Dancing Script" },
            { name: "Indie Flower", family: "Indie Flower" },
            { name: "Shadows Into Light", family: "Shadows Into Light" },
            { name: "Amatic SC", family: "Amatic SC" },
            { name: "Bangers", family: "Bangers" },
            { name: "Permanent Marker", family: "Permanent Marker" },
            { name: "Orbitron", family: "Orbitron" },
            { name: "Press Start 2P", family: "Press Start 2P" },
            { name: "Russo One", family: "Russo One" },
            { name: "Bungee", family: "Bungee" },
            { name: "Alfa Slab One", family: "Alfa Slab One" },
            { name: "Luckiest Guy", family: "Luckiest Guy" },
            { name: "Passion One", family: "Passion One" },
            { name: "Titan One", family: "Titan One" },
            { name: "Lilita One", family: "Lilita One" },
            { name: "Chewy", family: "Chewy" },
            { name: "Fugaz One", family: "Fugaz One" },
            { name: "Lemon", family: "Lemon" },
            { name: "Sigmar One", family: "Sigmar One" },
            { name: "Rubik Mono One", family: "Rubik Mono One" },
            { name: "Black Ops One", family: "Black Ops One" },
            { name: "Boogaloo", family: "Boogaloo" },
            { name: "Creepster", family: "Creepster" },
            { name: "Fascinate", family: "Fascinate" },
            { name: "Freckle Face", family: "Freckle Face" },
            { name: "Gorditas", family: "Gorditas" },
            { name: "Holtwood One SC", family: "Holtwood One SC" },
            { name: "Knewave", family: "Knewave" },
            { name: "Modak", family: "Modak" },
            { name: "Monoton", family: "Monoton" },
            { name: "Nabla", family: "Nabla" },
            { name: "Neucha", family: "Neucha" },
            { name: "Oleo Script", family: "Oleo Script" },
            { name: "Rampart One", family: "Rampart One" },
            { name: "Ribeye", family: "Ribeye" },
            { name: "Rye", family: "Rye" },
            { name: "Shrikhand", family: "Shrikhand" },
            { name: "Sunshiney", family: "Sunshiney" }
        ];

        // ============ DATOS DEL JUEGO ============
        const levels = [
            { theme: "Animales", words: ["GATO", "PERRO", "PEZ", "AVE"], size: 7 },
            { theme: "Colores", words: ["ROJO", "AZUL", "VERDE", "ROSA"], size: 7 },
            { theme: "N√∫meros", words: ["UNO", "DOS", "TRES", "DIEZ"], size: 7 },
            { theme: "Familia", words: ["MAMA", "PAPA", "HIJO", "TIA"], size: 7 },
            { theme: "Frutas", words: ["PERA", "UVA", "KIWI", "LIMA"], size: 7 },
            { theme: "Comida", words: ["PAN", "QUESO", "LECHE", "HUEVO", "ARROZ"], size: 8 },
            { theme: "Cuerpo", words: ["MANO", "PIE", "OJO", "NARIZ", "BOCA"], size: 8 },
            { theme: "Casa", words: ["SALA", "COCINA", "CAMA", "MESA", "SILLA"], size: 8 },
            { theme: "Naturaleza", words: ["SOL", "LUNA", "ARBOL", "FLOR", "RIO"], size: 8 },
            { theme: "Escuela", words: ["LIBRO", "LAPIZ", "MESA", "CLASE", "PATIO"], size: 8 },
            { theme: "Deportes", words: ["FUTBOL", "TENIS", "GOLF", "BOXEO", "JUDO", "SURF"], size: 9 },
            { theme: "Ropa", words: ["FALDA", "CAMISA", "ZAPATO", "GORRO", "BOLSO"], size: 9 },
            { theme: "Transporte", words: ["AUTO", "TREN", "AVION", "BARCO", "METRO", "MOTO"], size: 9 },
            { theme: "Clima", words: ["LLUVIA", "NIEVE", "VIENTO", "SOL", "NUBE", "RAYO"], size: 9 },
            { theme: "Instrumentos", words: ["PIANO", "FLAUTA", "TAMBOR", "VIOLIN", "ARPA"], size: 9 },
            { theme: "Profesiones", words: ["DOCTOR", "PILOTO", "CHEF", "ACTOR", "PINTOR", "JUEZ"], size: 10 },
            { theme: "Pa√≠ses", words: ["MEXICO", "PERU", "CHILE", "CUBA", "BRASIL", "PANAMA"], size: 10 },
            { theme: "Salvajes", words: ["TIGRE", "LEON", "CEBRA", "JIRAFA", "MONO", "OSO"], size: 10 },
            { theme: "Flores", words: ["ROSA", "TULIPAN", "GIRASOL", "LIRIO", "CLAVEL"], size: 10 },
            { theme: "Verduras", words: ["TOMATE", "CEBOLLA", "PAPA", "LECHUGA", "MAIZ"], size: 10 },
            { theme: "Espacio", words: ["PLANETA", "ESTRELLA", "LUNA", "SOL", "GALAXIA", "COMETA"], size: 10 },
            { theme: "Oc√©ano", words: ["BALLENA", "TIBURON", "PULPO", "CORAL", "MEDUSA", "DELFIN"], size: 10 },
            { theme: "Cocina", words: ["SARTEN", "OLLA", "CUCHILLO", "TENEDOR", "PLATO", "VASO"], size: 10 },
            { theme: "Tecnolog√≠a", words: ["CELULAR", "LAPTOP", "TABLET", "MOUSE", "TECLADO"], size: 10 },
            { theme: "M√∫sica", words: ["ROCK", "JAZZ", "SALSA", "REGGAE", "CUMBIA", "POP"], size: 10 },
            { theme: "Geograf√≠a", words: ["MONTANA", "OCEANO", "DESIERTO", "VOLCAN", "ISLA", "LAGO", "SELVA"], size: 11 },
            { theme: "Historia", words: ["IMPERIO", "FARAON", "PIRAMIDE", "CASTILLO", "CORONA", "ESPADA"], size: 11 },
            { theme: "Ciencia", words: ["ATOMO", "CELULA", "ENERGIA", "QUIMICA", "FISICA", "ADN"], size: 11 },
            { theme: "Arte", words: ["PINTURA", "ESCULTURA", "MUSEO", "LIENZO", "PINCEL", "PALETA"], size: 11 },
            { theme: "Literatura", words: ["NOVELA", "POEMA", "CUENTO", "FABULA", "AUTOR", "POETA"], size: 11 },
            { theme: "Arquitectura", words: ["EDIFICIO", "COLUMNA", "ARCO", "CUPULA", "FACHADA", "BALCON"], size: 11 },
            { theme: "Medicina", words: ["HOSPITAL", "MEDICINA", "VACUNA", "FARMACIA", "CLINICA", "SALUD"], size: 11 },
            { theme: "Gastronom√≠a", words: ["RECETA", "SABOR", "AROMA", "GOURMET", "MENU", "CHEF"], size: 11 },
            { theme: "Moda", words: ["VESTIDO", "ELEGANTE", "PASARELA", "MODELO", "ESTILO", "TELA"], size: 11 },
            { theme: "Cine", words: ["PELICULA", "DIRECTOR", "ACTRIZ", "GUION", "ESCENA", "CAMARA"], size: 11 },
            { theme: "Filosof√≠a", words: ["RAZON", "LOGICA", "ETICA", "MORAL", "VIRTUD", "VERDAD", "IDEA"], size: 12 },
            { theme: "Econom√≠a", words: ["MERCADO", "CAPITAL", "EMPRESA", "COMERCIO", "AHORRO", "BANCO"], size: 12 },
            { theme: "Pol√≠tica", words: ["GOBIERNO", "CONGRESO", "SENADO", "PARTIDO", "LEY", "PODER", "VOTO"], size: 12 },
            { theme: "Psicolog√≠a", words: ["MENTE", "CONDUCTA", "EMOCION", "MEMORIA", "TERAPIA", "TRAUMA"], size: 12 },
            { theme: "Astronom√≠a", words: ["UNIVERSO", "TELESCOPIO", "SATELITE", "ORBITA", "NEBULOSA", "ECLIPSE"], size: 12 },
            { theme: "Mitolog√≠a", words: ["ZEUS", "HERCULES", "ATENEA", "POSEIDON", "HADES", "APOLO", "OLIMPO"], size: 12 },
            { theme: "Biolog√≠a", words: ["ARRECIFE", "PLANCTON", "MOLUSCO", "OCEANO", "FAUNA", "FLORA", "MAREA"], size: 12 },
            { theme: "Renacimiento", words: ["DAVINCI", "MIGUEL", "ANGEL", "RAFAEL", "FLORENCIA", "VENECIA"], size: 12 },
            { theme: "Cl√°sica", words: ["SINFONIA", "CONCIERTO", "ORQUESTA", "SOPRANO", "OPERA", "SONATA"], size: 12 },
            { theme: "Qu√≠mica", words: ["ELEMENTO", "COMPUESTO", "REACCION", "SOLUCION", "ACIDO", "BASE", "ENLACE"], size: 13 },
            { theme: "Ingenier√≠a", words: ["ESTRUCTURA", "CIRCUITO", "SISTEMA", "PROYECTO", "CALCULO", "MOTOR"], size: 13 },
            { theme: "Neurociencia", words: ["CEREBRO", "NEURONA", "SINAPSIS", "CORTEZA", "AXON", "HORMONA"], size: 13 },
            { theme: "Arqueolog√≠a", words: ["EXCAVACION", "FOSIL", "RELIQUIA", "RUINAS", "TUMBA", "MOMIA", "PAPIRO"], size: 13 },
            { theme: "Derecho", words: ["TRIBUNAL", "ABOGADO", "SENTENCIA", "DEMANDA", "JURADO", "FISCAL", "LEY"], size: 13 },
            { theme: "Gran Final", words: ["MAGNIFICO", "INCREIBLE", "FANTASTICO", "ASOMBROSO", "BRILLANTE", "GENIAL", "EPICO"], size: 14 }
        ];

        const backgrounds = [
            'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800',
            'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=800',
            'https://images.unsplash.com/photo-1501854140801-50d01698950b?w=800',
            'https://images.unsplash.com/photo-1433086966358-54859d0ed716?w=800',
            'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800',
            'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=800',
            'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800',
            'https://images.unsplash.com/photo-1472214103451-9374bd1c798e?w=800',
            'https://images.unsplash.com/photo-1518837695005-2083093ee35b?w=800',
            'https://images.unsplash.com/photo-1682687220742-aba13b6e50ba?w=800'
        ];

        // ============ ESTADO ============
        let currentLevel = 1;
        let maxLevel = 1;
        let foundWords = [];
        let grid = [];
        let gridSize = 8;
        let selectedCells = [];
        let isSelecting = false;
        let placedWords = [];
        let musicOn = false;
        let unlockedFonts = [];

        // ============ ELEMENTOS ============
        const $ = id => document.getElementById(id);
        const menuScreen = $('menuScreen');
        const levelScreen = $('levelScreen');
        const gameScreen = $('gameScreen');
        const fontsScreen = $('fontsScreen');
        const gameBg = $('gameBg');
        const levelsGrid = $('levelsGrid');
        const gameGrid = $('gameGrid');
        const wordList = $('wordList');
        const canvas = $('selectionCanvas');
        const ctx = canvas.getContext('2d');
        const bgMusic = $('bgMusic');

        // ============ INICIALIZAR ============
        function init() {
            loadProgress();
            setBackground();
            updateMenuStats();
            setupEvents();
        }

        function setBackground() {
            const bg = backgrounds[Math.floor(Math.random() * backgrounds.length)];
            gameBg.style.backgroundImage = `url(${bg})`;
        }

        function loadProgress() {
            const saved = localStorage.getItem('sopaMaxLevel');
            if (saved) maxLevel = parseInt(saved) || 1;
            
            const savedFonts = localStorage.getItem('sopaUnlockedFonts');
            if (savedFonts) {
                unlockedFonts = JSON.parse(savedFonts);
            }
        }

        function saveProgress() {
            localStorage.setItem('sopaMaxLevel', maxLevel.toString());
            localStorage.setItem('sopaUnlockedFonts', JSON.stringify(unlockedFonts));
            updateMenuStats();
        }

        function updateMenuStats() {
            $('menuMaxLevel').textContent = maxLevel;
            $('menuFontsUnlocked').textContent = unlockedFonts.length;
            $('maxLevelText').textContent = maxLevel;
            $('fontsUnlockedCount').textContent = unlockedFonts.length;
        }

        // ============ PANTALLAS ============
        function showScreen(screen) {
            menuScreen.classList.remove('active');
            levelScreen.classList.remove('active');
            gameScreen.classList.remove('active');
            fontsScreen.classList.remove('active');
            screen.classList.add('active');
        }

        function showMenu() {
            setBackground();
            updateMenuStats();
            showScreen(menuScreen);
        }

        function showLevels() {
            setBackground();
            renderLevels();
            showScreen(levelScreen);
        }

        function showFonts() {
            renderFonts();
            showScreen(fontsScreen);
        }

        function showGame() {
            showScreen(gameScreen);
        }

        // ============ NIVELES ============
        function renderLevels() {
            levelsGrid.innerHTML = '';
            for (let i = 1; i <= 50; i++) {
                const btn = document.createElement('button');
                const locked = i > maxLevel;
                const completed = i < maxLevel;
                
                btn.className = `level-btn ${locked ? 'locked bg-gray-700/50' : completed ? 'bg-gradient-to-br from-green-500 to-emerald-600' : 'bg-gradient-to-br from-purple-500 to-pink-500'} text-white`;
                btn.style.fontSize = '1.3rem';
                
                if (locked) {
                    btn.innerHTML = 'üîí';
                } else {
                    btn.textContent = i;
                    btn.onclick = () => startLevel(i);
                }
                
                levelsGrid.appendChild(btn);
            }
        }

        // ============ FUENTES ============
        function renderFonts() {
            const grid = $('fontsGrid');
            grid.innerHTML = '';
            
            fontData.forEach((font, index) => {
                const level = index + 1;
                const isUnlocked = unlockedFonts.includes(level);
                
                const card = document.createElement('div');
                card.className = `font-card glass rounded-xl p-4 ${isUnlocked ? '' : 'locked'}`;
                
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs bg-white/20 px-2 py-1 rounded-full">Nivel ${level}</span>
                        <span class="text-lg">${isUnlocked ? '‚úÖ' : 'üîí'}</span>
                    </div>
                    <p class="font-${level} text-xl mb-1" style="font-family: '${font.family}', cursive;">${font.name}</p>
                    <p class="font-${level} text-2xl text-purple-300" style="font-family: '${font.family}', cursive;">ABC xyz</p>
                    ${isUnlocked ? `
                        <button onclick="downloadFont('${font.family}')" class="mt-3 w-full py-2 bg-gradient-to-r from-amber-500 to-orange-500 rounded-lg text-sm font-bold flex items-center justify-center gap-2 hover:from-amber-400 hover:to-orange-400 transition">
                            ‚¨áÔ∏è Descargar
                        </button>
                    ` : `
                        <p class="mt-3 text-xs text-white/40 text-center">Completa el nivel ${level} para desbloquear</p>
                    `}
                `;
                
                grid.appendChild(card);
            });
        }

        function downloadFont(fontFamily) {
            const fontUrl = `https://fonts.google.com/specimen/${fontFamily.replace(/ /g, '+')}`;
            window.open(fontUrl, '_blank');
        }

        // ============ JUEGO ============
        function startLevel(level) {
            currentLevel = level;
            foundWords = [];
            selectedCells = [];
            placedWords = [];
            
            const data = levels[level - 1];
            gridSize = data.size;
            
            $('levelTitle').textContent = `Nivel ${level}`;
            $('levelTheme').textContent = data.theme;
            
            // Fuente √∫nica para cada nivel
            gameGrid.className = `grid gap-[1px] h-full w-full relative z-10 font-${level}`;
            wordList.className = `flex flex-wrap justify-center font-${level}`;
            
            generateGrid(data.words);
            renderWords(data.words);
            showGame();
            
            setTimeout(resizeCanvas, 100);
            
            if (musicOn) bgMusic.play().catch(() => {});
        }

        function generateGrid(words) {
            grid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(''));
            placedWords = [];
            
            const sorted = [...words].sort((a, b) => b.length - a.length);
            sorted.forEach(word => placeWord(word));
            
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (!grid[i][j]) {
                        grid[i][j] = letters[Math.floor(Math.random() * 26)];
                    }
                }
            }
            
            renderGrid();
        }

        function placeWord(word) {
            const dirs = [[0,1],[1,0],[1,1],[1,-1],[-1,1],[-1,-1],[0,-1],[-1,0]];
            
            for (let a = 0; a < 100; a++) {
                const d = dirs[Math.floor(Math.random() * 8)];
                const r = Math.floor(Math.random() * gridSize);
                const c = Math.floor(Math.random() * gridSize);
                
                if (canPlace(word, r, c, d)) {
                    const cells = [];
                    for (let i = 0; i < word.length; i++) {
                        const nr = r + i * d[0];
                        const nc = c + i * d[1];
                        grid[nr][nc] = word[i];
                        cells.push({ row: nr, col: nc });
                    }
                    placedWords.push({ word, cells });
                    return;
                }
            }
        }

        function canPlace(word, r, c, d) {
            for (let i = 0; i < word.length; i++) {
                const nr = r + i * d[0];
                const nc = c + i * d[1];
                if (nr < 0 || nr >= gridSize || nc < 0 || nc >= gridSize) return false;
                if (grid[nr][nc] && grid[nr][nc] !== word[i]) return false;
            }
            return true;
        }

        function renderGrid() {
            gameGrid.innerHTML = '';
            gameGrid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            
            const container = $('gridContainer');
            const containerHeight = container.offsetHeight || window.innerHeight * 0.6;
            const containerWidth = container.offsetWidth || window.innerWidth * 0.98;
            const cellSize = Math.min(containerWidth, containerHeight) / gridSize;
            const fontSize = Math.max(14, Math.floor(cellSize * 0.6));
            
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.style.fontSize = `${fontSize}px`;
                    cell.textContent = grid[i][j];
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    gameGrid.appendChild(cell);
                }
            }
        }

        function renderWords(words) {
            wordList.innerHTML = '';
            words.forEach(word => {
                const span = document.createElement('span');
                span.className = 'word-item text-white';
                span.textContent = word;
                span.id = `w-${word}`;
                wordList.appendChild(span);
            });
            $('foundCount').textContent = '0';
            $('totalCount').textContent = words.length;
        }

        // ============ INTERACCI√ìN ============
        function setupEvents() {
            // Men√∫ principal
            $('playBtn').onclick = showLevels;
            $('fontsBtn').onclick = showFonts;
            $('exitBtn').onclick = () => $('exitModal').classList.add('show');
            $('cancelExitBtn').onclick = () => $('exitModal').classList.remove('show');
            $('confirmExitBtn').onclick = () => {
                $('exitModal').classList.remove('show');
                // En una app real cerrar√≠a la aplicaci√≥n
                alert('¬°Gracias por jugar! üëã');
            };
            
            // Navegaci√≥n
            $('backToMenuBtn').onclick = showMenu;
            $('backToMenuFromFonts').onclick = showMenu;
            $('backBtn').onclick = showLevels;
            
            // M√∫sica
            $('musicBtn').onclick = toggleMusic;
            $('musicBtnMenu').onclick = toggleMusic;
            
            // Modales
            $('hintBtn').onclick = () => $('hintModal').classList.add('show');
            $('cancelHintBtn').onclick = () => $('hintModal').classList.remove('show');
            $('watchAdBtn').onclick = watchAd;
            
            $('replayBtn').onclick = () => {
                $('completeModal').classList.remove('show');
                startLevel(currentLevel);
            };
            
            $('nextBtn').onclick = () => {
                $('completeModal').classList.remove('show');
                if (currentLevel < 50) startLevel(currentLevel + 1);
                else showLevels();
            };
            
            // Interacci√≥n con grid
            gameGrid.addEventListener('mousedown', startSelect);
            gameGrid.addEventListener('touchstart', startSelect, { passive: false });
            document.addEventListener('mousemove', continueSelect);
            document.addEventListener('touchmove', continueSelect, { passive: false });
            document.addEventListener('mouseup', endSelect);
            document.addEventListener('touchend', endSelect);
            
            window.addEventListener('resize', () => {
                if (gameScreen.classList.contains('active')) {
                    resizeCanvas();
                    renderGrid();
                }
            });
        }

        function startSelect(e) {
            e.preventDefault();
            const cell = e.target.closest('.grid-cell');
            if (!cell) return;
            
            isSelecting = true;
            selectedCells = [];
            addCell(cell);
        }

        function continueSelect(e) {
            if (!isSelecting) return;
            e.preventDefault();
            
            let target;
            if (e.touches) {
                const touch = e.touches[0];
                target = document.elementFromPoint(touch.clientX, touch.clientY);
            } else {
                target = e.target;
            }
            
            const cell = target?.closest('.grid-cell');
            if (cell && !selectedCells.includes(cell) && isValidNext(cell)) {
                addCell(cell);
            }
            drawLine();
        }

        function endSelect() {
            if (!isSelecting) return;
            isSelecting = false;
            checkWord();
            clearSelect();
        }

        function addCell(cell) {
            selectedCells.push(cell);
            cell.classList.add('selected');
            cell.style.background = 'rgba(168, 85, 247, 0.85)';
            cell.style.color = '#fff';
        }

        function isValidNext(cell) {
            if (selectedCells.length === 0) return true;
            
            const last = selectedCells[selectedCells.length - 1];
            const lr = parseInt(last.dataset.row);
            const lc = parseInt(last.dataset.col);
            const nr = parseInt(cell.dataset.row);
            const nc = parseInt(cell.dataset.col);
            
            if (Math.abs(nr - lr) > 1 || Math.abs(nc - lc) > 1) return false;
            
            if (selectedCells.length > 1) {
                const first = selectedCells[0];
                const fr = parseInt(first.dataset.row);
                const fc = parseInt(first.dataset.col);
                
                const expDr = Math.sign(lr - fr);
                const expDc = Math.sign(lc - fc);
                const newDr = Math.sign(nr - lr);
                const newDc = Math.sign(nc - lc);
                
                if (expDr !== 0 && newDr !== expDr) return false;
                if (expDc !== 0 && newDc !== expDc) return false;
                if (expDr === 0 && newDr !== 0) return false;
                if (expDc === 0 && newDc !== 0) return false;
            }
            
            return true;
        }

        function clearSelect() {
            selectedCells.forEach(cell => {
                cell.classList.remove('selected');
                if (!cell.classList.contains('found')) {
                    cell.style.background = 'rgba(255, 255, 255, 0.08)';
                    cell.style.color = '#ffffff';
                }
            });
            selectedCells = [];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function checkWord() {
            const word = selectedCells.map(c => c.textContent).join('');
            const rev = word.split('').reverse().join('');
            const data = levels[currentLevel - 1];
            
            const found = data.words.find(w => (w === word || w === rev) && !foundWords.includes(w));
            
            if (found) {
                foundWords.push(found);
                
                const item = $(`w-${found}`);
                if (item) {
                    item.classList.add('found', 'celebrate');
                }
                
                const colors = [
                    'rgba(239,68,68,0.75)', 
                    'rgba(34,197,94,0.75)', 
                    'rgba(59,130,246,0.75)', 
                    'rgba(168,85,247,0.75)', 
                    'rgba(236,72,153,0.75)', 
                    'rgba(234,179,8,0.75)'
                ];
                const color = colors[foundWords.length % 6];
                
                selectedCells.forEach(cell => {
                    cell.classList.add('found');
                    cell.style.background = color;
                    cell.style.color = '#fff';
                });
                
                $('foundCount').textContent = foundWords.length;
                
                if (foundWords.length === data.words.length) {
                    setTimeout(levelComplete, 500);
                }
            }
        }

        function drawLine() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (selectedCells.length < 2) return;
            
            const rect = canvas.getBoundingClientRect();
            
            ctx.beginPath();
            ctx.lineWidth = Math.min(25, canvas.width / gridSize * 0.7);
            ctx.lineCap = 'round';
            ctx.strokeStyle = 'rgba(168, 85, 247, 0.5)';
            
            selectedCells.forEach((cell, i) => {
                const cr = cell.getBoundingClientRect();
                const x = cr.left - rect.left + cr.width / 2;
                const y = cr.top - rect.top + cr.height / 2;
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            
            ctx.stroke();
        }

        function resizeCanvas() {
            const container = $('gridContainer');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
        }

        // ============ COMPLETAR NIVEL ============
        function levelComplete() {
            confetti();
            
            // Desbloquear fuente del nivel
            const fontWasNew = !unlockedFonts.includes(currentLevel);
            if (fontWasNew) {
                unlockedFonts.push(currentLevel);
            }
            
            // Avanzar nivel m√°ximo
            if (currentLevel >= maxLevel && currentLevel < 50) {
                maxLevel = currentLevel + 1;
            }
            
            saveProgress();
            
            // Mostrar info de fuente desbloqueada
            const fontSection = $('fontUnlockSection');
            if (fontWasNew) {
                fontSection.style.display = 'block';
                const font = fontData[currentLevel - 1];
                $('unlockedFontName').textContent = font.name;
                $('unlockedFontName').style.fontFamily = `'${font.family}', cursive`;
                $('unlockedFontPreview').style.fontFamily = `'${font.family}', cursive`;
            } else {
                fontSection.style.display = 'none';
            }
            
            $('completeModal').classList.add('show');
        }

        function confetti() {
            const colors = ['#ef4444', '#22c55e', '#3b82f6', '#a855f7', '#ec4899', '#eab308'];
            for (let i = 0; i < 60; i++) {
                setTimeout(() => {
                    const el = document.createElement('div');
                    el.className = 'confetti';
                    el.style.left = Math.random() * 100 + 'vw';
                    el.style.top = '-10px';
                    el.style.background = colors[Math.floor(Math.random() * 6)];
                    el.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    el.style.width = (Math.random() * 12 + 6) + 'px';
                    el.style.height = (Math.random() * 12 + 6) + 'px';
                    document.body.appendChild(el);
                    
                    el.animate([
                        { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                        { transform: `translateY(100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                    ], { duration: 2500 + Math.random() * 1500, easing: 'ease-out' }).onfinish = () => el.remove();
                }, i * 25);
            }
        }

        // ============ PISTAS ============
        function watchAd() {
            const loading = $('adLoading');
            loading.classList.remove('hidden');
            
            // Aqu√≠ ir√° la integraci√≥n de AdMob
            setTimeout(() => {
                loading.classList.add('hidden');
                $('hintModal').classList.remove('show');
                giveHint();
            }, 2000);
        }

        function giveHint() {
            const data = levels[currentLevel - 1];
            const unfound = data.words.find(w => !foundWords.includes(w));
            
            if (unfound) {
                const pw = placedWords.find(p => p.word === unfound);
                if (pw && pw.cells.length > 0) {
                    const { row, col } = pw.cells[0];
                    const cell = gameGrid.children[row * gridSize + col];
                    
                    cell.style.background = 'rgba(234, 179, 8, 0.95)';
                    cell.style.color = '#fff';
                    cell.style.boxShadow = '0 0 25px rgba(234, 179, 8, 1)';
                    
                    setTimeout(() => {
                        if (!cell.classList.contains('found')) {
                            cell.style.background = 'rgba(255, 255, 255, 0.08)';
                            cell.style.color = '#ffffff';
                            cell.style.boxShadow = '';
                        }
                    }, 3000);
                }
            }
        }

        // ============ M√öSICA ============
        function toggleMusic() {
            musicOn = !musicOn;
            const icon = musicOn ? 'üîä' : 'üîá';
            $('musicBtn').textContent = icon;
            $('musicBtnMenu').textContent = icon;
            
            if (musicOn) {
                bgMusic.play().catch(() => {});
            } else {
                bgMusic.pause();
            }
        }

        // ============ INICIO ============
        init();
    </script>
</body>
</html>
